import{a as n,j as e,g as t,b as r,h as a,i as o,k as s,f as i}from"./index-C-f8kXnX.js";import{r as c}from"./vendor-X31hiD63.js";import"./icons-jm45AAY8.js";const l="/api";function d(n){if(!n)return"";const e=new Date(n),t=new Date-e;return t<6e4?"الآن":t<36e5?`منذ ${Math.floor(t/6e4)} دقيقة`:t<864e5?`منذ ${Math.floor(t/36e5)} ساعة`:t<6048e5?`منذ ${Math.floor(t/864e5)} يوم`:e.toLocaleDateString("ar-SA",{year:"numeric",month:"short",day:"numeric"})}function m({comment:n,currentUserId:t,onReply:r,onEdit:l,onDelete:p,depth:x=0}){var u;const[h,b]=c.useState(!1),[g,y]=c.useState(""),[v,f]=c.useState(!1),[j,w]=c.useState(n.content),[N,k]=c.useState(!1),S=n.user_id===t;return e.jsxs("div",{className:"comment "+(x>0?"reply":""),style:{marginRight:24*x},children:[e.jsxs("div",{className:"comment-header",children:[e.jsx("span",{className:"comment-author",children:(null==(u=n.user_id)?void 0:u.substring(0,8))||"مستخدم"}),e.jsx("span",{className:"comment-date",children:d(n.created_at)}),n.updated_at!==n.created_at&&e.jsx("span",{className:"comment-edited",children:"(معدّل)"})]}),v?e.jsxs("div",{className:"comment-edit",children:[e.jsx("textarea",{value:j,onChange:n=>w(n.target.value),rows:2,autoFocus:!0}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{onClick:async()=>{if(j.trim()){k(!0);try{await l(n.id,j.trim()),f(!1)}finally{k(!1)}}},disabled:N,children:N?"جاري الحفظ...":"حفظ"}),e.jsx("button",{onClick:()=>f(!1),className:"cancel",children:"إلغاء"})]})]}):e.jsx("div",{className:"comment-content",children:n.content}),e.jsxs("div",{className:"comment-actions",children:[x<2&&e.jsxs("button",{onClick:()=>b(!h),children:[e.jsx(o,{})," رد"]}),S&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>f(!0),children:[e.jsx(s,{})," تعديل"]}),e.jsxs("button",{onClick:()=>p(n.id),className:"danger",children:[e.jsx(i,{})," حذف"]})]})]}),h&&e.jsxs("div",{className:"reply-input",children:[e.jsx("textarea",{value:g,onChange:n=>y(n.target.value),placeholder:"اكتب ردك...",rows:2,autoFocus:!0}),e.jsxs("div",{className:"reply-actions",children:[e.jsxs("button",{onClick:async()=>{if(g.trim()){k(!0);try{await r(n.id,g.trim()),y(""),b(!1)}finally{k(!1)}}},disabled:N||!g.trim(),children:[e.jsx(a,{})," ",N?"جاري الإرسال...":"إرسال"]}),e.jsx("button",{onClick:()=>b(!1),className:"cancel",children:"إلغاء"})]})]}),n.replies&&n.replies.length>0&&e.jsx("div",{className:"comment-replies",children:n.replies.map(n=>e.jsx(m,{comment:n,currentUserId:t,onReply:r,onEdit:l,onDelete:p,depth:x+1},n.id))})]})}function p({fileId:o,currentUserId:s,onClose:i}){const[d,p]=c.useState([]),[x,u]=c.useState(""),[h,b]=c.useState(!0),[g,y]=c.useState(!1),[v,f]=c.useState(0),j=c.useRef(null);c.useEffect(()=>{w()},[o]);const w=async()=>{try{b(!0);const e=await n.get(`${l}/comments/${o}`);p(e.data.comments||[]),f(e.data.count||0)}catch(e){}finally{b(!1)}},N=async(e,t)=>{var r,a;try{await n.post(`${l}/comments/${o}`,{content:t,parentId:e}),w()}catch(s){alert((null==(a=null==(r=s.response)?void 0:r.data)?void 0:a.error)||"فشل في إضافة الرد")}},k=async(e,t)=>{var r,a;try{await n.patch(`${l}/comments/${e}`,{content:t}),w()}catch(o){alert((null==(a=null==(r=o.response)?void 0:r.data)?void 0:a.error)||"فشل في تعديل التعليق")}},S=async e=>{var t,r;if(confirm("هل أنت متأكد من حذف هذا التعليق؟"))try{await n.delete(`${l}/comments/${e}`),w()}catch(a){alert((null==(r=null==(t=a.response)?void 0:t.data)?void 0:r.error)||"فشل في حذف التعليق")}};return e.jsxs("div",{className:"comments-panel",children:[e.jsxs("div",{className:"comments-header",children:[e.jsxs("h4",{children:[e.jsx(t,{})," التعليقات (",v,")"]}),i&&e.jsx("button",{className:"close-btn",onClick:i,children:e.jsx(r,{})})]}),e.jsxs("form",{onSubmit:async e=>{var t,r;if(e.preventDefault(),x.trim()){y(!0);try{await n.post(`${l}/comments/${o}`,{content:x.trim()}),u(""),w()}catch(a){alert((null==(r=null==(t=a.response)?void 0:t.data)?void 0:r.error)||"فشل في إضافة التعليق")}finally{y(!1)}}},className:"comment-form",children:[e.jsx("textarea",{ref:j,value:x,onChange:n=>u(n.target.value),placeholder:"اكتب تعليقك...",rows:2,maxLength:2e3}),e.jsxs("button",{type:"submit",disabled:g||!x.trim(),children:[e.jsx(a,{})," ",g?"جاري الإرسال...":"إرسال"]})]}),e.jsx("div",{className:"comments-list",children:h?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"جاري تحميل التعليقات..."})]}):0===d.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(t,{size:32}),e.jsx("p",{children:"لا توجد تعليقات بعد"}),e.jsx("small",{children:"كن أول من يعلق!"})]}):d.map(n=>e.jsx(m,{comment:n,currentUserId:s,onReply:N,onEdit:k,onDelete:S},n.id))}),e.jsx("style",{children:"\n        .comments-panel {\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n          background: var(--bg-primary);\n        }\n\n        .comments-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 12px 16px;\n          border-bottom: 1px solid var(--border-color);\n        }\n\n        .comments-header h4 {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          margin: 0;\n        }\n\n        .comment-form {\n          padding: 12px 16px;\n          border-bottom: 1px solid var(--border-color);\n        }\n\n        .comment-form textarea {\n          width: 100%;\n          padding: 10px;\n          border: 1px solid var(--border-color);\n          border-radius: 8px;\n          resize: none;\n          font-family: inherit;\n          margin-bottom: 8px;\n        }\n\n        .comment-form button {\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          padding: 8px 16px;\n          background: var(--primary-color);\n          color: white;\n          border: none;\n          border-radius: 6px;\n          cursor: pointer;\n        }\n\n        .comment-form button:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        .comments-list {\n          flex: 1;\n          overflow-y: auto;\n          padding: 16px;\n        }\n\n        .comment {\n          margin-bottom: 16px;\n          padding: 12px;\n          background: var(--bg-secondary);\n          border-radius: 8px;\n        }\n\n        .comment.reply {\n          background: var(--bg-hover);\n          border-right: 3px solid var(--primary-color);\n        }\n\n        .comment-header {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          margin-bottom: 8px;\n          font-size: 0.85em;\n        }\n\n        .comment-author {\n          font-weight: 600;\n          color: var(--primary-color);\n        }\n\n        .comment-date {\n          color: var(--text-secondary);\n        }\n\n        .comment-edited {\n          color: var(--text-secondary);\n          font-style: italic;\n        }\n\n        .comment-content {\n          line-height: 1.6;\n          white-space: pre-wrap;\n          word-break: break-word;\n        }\n\n        .comment-actions {\n          display: flex;\n          gap: 12px;\n          margin-top: 8px;\n        }\n\n        .comment-actions button {\n          display: flex;\n          align-items: center;\n          gap: 4px;\n          padding: 4px 8px;\n          background: transparent;\n          border: none;\n          color: var(--text-secondary);\n          cursor: pointer;\n          font-size: 0.85em;\n          border-radius: 4px;\n        }\n\n        .comment-actions button:hover {\n          background: var(--bg-hover);\n          color: var(--primary-color);\n        }\n\n        .comment-actions button.danger:hover {\n          color: #dc3545;\n        }\n\n        .reply-input, .comment-edit {\n          margin-top: 12px;\n          padding-top: 12px;\n          border-top: 1px solid var(--border-color);\n        }\n\n        .reply-input textarea, .comment-edit textarea {\n          width: 100%;\n          padding: 8px;\n          border: 1px solid var(--border-color);\n          border-radius: 6px;\n          resize: none;\n          font-family: inherit;\n        }\n\n        .reply-actions, .edit-actions {\n          display: flex;\n          gap: 8px;\n          margin-top: 8px;\n        }\n\n        .reply-actions button, .edit-actions button {\n          display: flex;\n          align-items: center;\n          gap: 4px;\n          padding: 6px 12px;\n          border: none;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 0.85em;\n        }\n\n        .reply-actions button:first-child, .edit-actions button:first-child {\n          background: var(--primary-color);\n          color: white;\n        }\n\n        .reply-actions button.cancel, .edit-actions button.cancel {\n          background: var(--bg-hover);\n          color: var(--text-primary);\n        }\n\n        .comment-replies {\n          margin-top: 12px;\n        }\n\n        .empty-state {\n          text-align: center;\n          padding: 40px 20px;\n          color: var(--text-secondary);\n        }\n\n        .empty-state svg {\n          opacity: 0.5;\n          margin-bottom: 12px;\n        }\n      "})]})}export{p as default};
