import{j as n,p as a,b as e,q as s,r as i,s as l,t as r,n as t,a as d}from"./index-CJD60P7J.js";import{r as o}from"./vendor-X31hiD63.js";import"./icons-jm45AAY8.js";const c="/api",p=({onClose:p,selectedFile:x,onTagsAdded:m,showToast:u})=>{var g;const[h,y]=o.useState(!1),[f,b]=o.useState(null),[v,j]=o.useState(null),[N,w]=o.useState("analyze");return n.jsxs("div",{className:"modal-overlay",onClick:p,children:[n.jsxs("div",{className:"ai-panel",onClick:n=>n.stopPropagation(),children:[n.jsxs("div",{className:"ai-panel-header",children:[n.jsxs("h2",{children:[n.jsx(a,{})," الذكاء الاصطناعي"]}),n.jsx("button",{className:"close-btn",onClick:p,children:n.jsx(e,{})})]}),n.jsxs("div",{className:"ai-panel-tabs",children:[n.jsxs("button",{className:"ai-tab "+("analyze"===N?"active":""),onClick:()=>{w("analyze"),b(null),j(null)},children:[n.jsx(s,{})," تحليل"]}),n.jsxs("button",{className:"ai-tab "+("ocr"===N?"active":""),onClick:()=>{w("ocr"),b(null),j(null)},children:[n.jsx(i,{})," استخراج نص"]}),n.jsxs("button",{className:"ai-tab "+("summarize"===N?"active":""),onClick:()=>{w("summarize"),b(null),j(null)},children:[n.jsx(l,{})," تلخيص"]})]}),n.jsxs("div",{className:"ai-panel-content",children:[x?n.jsxs("div",{className:"selected-file-info",children:[n.jsx(l,{}),n.jsxs("div",{children:[n.jsx("span",{className:"filename",children:x.name}),n.jsx("span",{className:"filetype",children:x.type||"غير معروف"})]})]}):n.jsxs("div",{className:"no-file-selected",children:[n.jsx(a,{size:48}),n.jsx("p",{children:"حدد ملفاً من القائمة لتحليله"}),n.jsx("small",{children:"اضغط على ملف ثم افتح لوحة الذكاء الاصطناعي"})]}),v&&n.jsx("div",{className:"ai-error",children:v}),x&&n.jsxs("div",{className:"ai-actions",children:["analyze"===N&&n.jsxs("button",{className:"ai-action-btn",onClick:async()=>{var n,a;if(x){y(!0),j(null),b(null);try{const n=await d.post(`${c}/ai/analyze`,{fileId:x.id});b({type:"analysis",data:n.data})}catch(e){j((null==(a=null==(n=e.response)?void 0:n.data)?void 0:a.error)||"فشل في تحليل الملف")}finally{y(!1)}}else j("يرجى تحديد ملف أولاً")},disabled:h,children:[n.jsx(s,{}),h?"جاري التحليل...":"تحليل الملف"]}),"ocr"===N&&n.jsxs("button",{className:"ai-action-btn",onClick:async()=>{var n,a,e;if(x)if(null==(n=x.type)?void 0:n.startsWith("image/")){y(!0),j(null),b(null);try{const n=await d.post(`${c}/ai/ocr/file/${x.id}`);b({type:"ocr",data:n.data})}catch(s){j((null==(e=null==(a=s.response)?void 0:a.data)?void 0:e.error)||"فشل في استخراج النص")}finally{y(!1)}}else j("استخراج النص متاح للصور فقط");else j("يرجى تحديد ملف أولاً")},disabled:h||!(null==(g=x.type)?void 0:g.startsWith("image/")),children:[n.jsx(i,{}),h?"جاري الاستخراج...":"استخراج النص (OCR)"]}),"summarize"===N&&n.jsxs("button",{className:"ai-action-btn",onClick:async()=>{var n,a;if(x){y(!0),j(null),b(null);try{const n=await d.post(`${c}/ai/summarize/file/${x.id}`);b({type:"summary",data:n.data})}catch(e){j((null==(a=null==(n=e.response)?void 0:n.data)?void 0:a.error)||"فشل في تلخيص الملف")}finally{y(!1)}}else j("يرجى تحديد ملف أولاً")},disabled:h,children:[n.jsx(l,{}),h?"جاري التلخيص...":"تلخيص المحتوى"]})]}),h&&n.jsxs("div",{className:"ai-loading",children:[n.jsx("div",{className:"spinner"}),n.jsx("span",{children:"جاري المعالجة..."})]}),(()=>{var a,e;if(!f)return null;if("analysis"===f.type){const e=f.data;return n.jsxs("div",{className:"ai-result",children:[n.jsx("h4",{children:"تحليل الملف"}),n.jsxs("div",{className:"analysis-grid",children:[n.jsxs("div",{className:"analysis-item",children:[n.jsx("span",{className:"label",children:"التصنيف:"}),n.jsx("span",{className:"value",children:e.category})]}),n.jsxs("div",{className:"analysis-item",children:[n.jsx("span",{className:"label",children:"النوع:"}),n.jsx("span",{className:"value",children:e.type})]}),n.jsxs("div",{className:"analysis-item",children:[n.jsx("span",{className:"label",children:"يدعم OCR:"}),n.jsx("span",{className:"value",children:e.canOCR?"✅ نعم":"❌ لا"})]}),n.jsxs("div",{className:"analysis-item",children:[n.jsx("span",{className:"label",children:"يدعم التلخيص:"}),n.jsx("span",{className:"value",children:e.canSummarize?"✅ نعم":"❌ لا"})]})]}),(null==(a=e.suggestedTags)?void 0:a.length)>0&&n.jsxs("div",{className:"suggested-tags",children:[n.jsxs("h5",{children:[n.jsx(r,{})," الوسوم المقترحة:"]}),n.jsx("div",{className:"tags-list",children:e.suggestedTags.map((a,e)=>n.jsx("span",{className:"tag",children:a},e))}),n.jsxs("button",{className:"apply-tags-btn",onClick:()=>(async n=>{var a,e;if(x&&(null==n?void 0:n.length))try{await d.post(`${c}/ai/classify/file/${x.id}`,{autoApply:!0}),null==u||u("تم إضافة الوسوم بنجاح","success"),null==m||m()}catch(s){null==u||u((null==(e=null==(a=s.response)?void 0:a.data)?void 0:e.error)||"فشل في إضافة الوسوم","error")}})(e.suggestedTags),children:[n.jsx(t,{})," تطبيق الوسوم"]})]})]})}return"ocr"===f.type?n.jsxs("div",{className:"ai-result",children:[n.jsx("h4",{children:"النص المستخرج"}),n.jsxs("div",{className:"ocr-info",children:[n.jsxs("span",{children:["الدقة: ",null==(e=f.data.confidence)?void 0:e.toFixed(1),"%"]}),n.jsxs("span",{children:["الكلمات: ",f.data.words]})]}),n.jsx("pre",{className:"extracted-text",children:f.data.text||"لم يتم العثور على نص"})]}):"summary"===f.type?n.jsxs("div",{className:"ai-result",children:[n.jsx("h4",{children:"ملخص المحتوى"}),n.jsx("pre",{className:"summary-text",children:f.data.summary}),n.jsxs("small",{className:"method",children:["الطريقة: ","ai"===f.data.method?"ذكاء اصطناعي":"محلي"]})]}):null})()]})]}),n.jsx("style",{children:"\n        .ai-panel {\n          background: var(--bg-primary, white);\n          border-radius: 16px;\n          width: 90%;\n          max-width: 500px;\n          max-height: 80vh;\n          overflow: hidden;\n          display: flex;\n          flex-direction: column;\n        }\n        .ai-panel-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 16px 20px;\n          border-bottom: 1px solid var(--border-color, #e0e0e0);\n        }\n        .ai-panel-header h2 {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          margin: 0;\n          font-size: 18px;\n        }\n        .ai-panel-tabs {\n          display: flex;\n          border-bottom: 1px solid var(--border-color, #e0e0e0);\n        }\n        .ai-tab {\n          flex: 1;\n          padding: 12px;\n          border: none;\n          background: none;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 6px;\n          color: var(--text-secondary, #666);\n          transition: all 0.2s;\n        }\n        .ai-tab:hover {\n          background: var(--bg-secondary, #f5f5f5);\n        }\n        .ai-tab.active {\n          color: var(--primary-color, #1a73e8);\n          border-bottom: 2px solid var(--primary-color, #1a73e8);\n        }\n        .ai-panel-content {\n          padding: 20px;\n          overflow-y: auto;\n          flex: 1;\n        }\n        .selected-file-info {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 12px;\n          background: var(--bg-secondary, #f5f5f5);\n          border-radius: 8px;\n          margin-bottom: 16px;\n        }\n        .selected-file-info > div {\n          display: flex;\n          flex-direction: column;\n        }\n        .selected-file-info .filename {\n          font-weight: 500;\n        }\n        .selected-file-info .filetype {\n          font-size: 12px;\n          color: var(--text-secondary, #666);\n        }\n        .no-file-selected {\n          text-align: center;\n          padding: 40px 20px;\n          color: var(--text-secondary, #666);\n        }\n        .no-file-selected p {\n          margin: 16px 0 8px;\n        }\n        .ai-error {\n          background: #ffebee;\n          color: #c62828;\n          padding: 12px;\n          border-radius: 8px;\n          margin-bottom: 16px;\n        }\n        .ai-actions {\n          margin-bottom: 16px;\n        }\n        .ai-action-btn {\n          width: 100%;\n          padding: 14px;\n          border: none;\n          border-radius: 8px;\n          background: var(--primary-color, #1a73e8);\n          color: white;\n          font-size: 15px;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 8px;\n          transition: all 0.2s;\n        }\n        .ai-action-btn:hover:not(:disabled) {\n          background: var(--primary-hover, #1557b0);\n        }\n        .ai-action-btn:disabled {\n          opacity: 0.6;\n          cursor: not-allowed;\n        }\n        .ai-loading {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 12px;\n          padding: 20px;\n          color: var(--text-secondary, #666);\n        }\n        .ai-result {\n          background: var(--bg-secondary, #f5f5f5);\n          border-radius: 12px;\n          padding: 16px;\n        }\n        .ai-result h4 {\n          margin: 0 0 12px;\n          font-size: 15px;\n        }\n        .analysis-grid {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 8px;\n        }\n        .analysis-item {\n          display: flex;\n          flex-direction: column;\n          padding: 8px;\n          background: var(--bg-primary, white);\n          border-radius: 6px;\n        }\n        .analysis-item .label {\n          font-size: 12px;\n          color: var(--text-secondary, #666);\n        }\n        .analysis-item .value {\n          font-weight: 500;\n        }\n        .suggested-tags {\n          margin-top: 16px;\n          padding-top: 16px;\n          border-top: 1px solid var(--border-color, #e0e0e0);\n        }\n        .suggested-tags h5 {\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          margin: 0 0 8px;\n          font-size: 14px;\n        }\n        .tags-list {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 6px;\n          margin-bottom: 12px;\n        }\n        .tags-list .tag {\n          padding: 4px 10px;\n          background: var(--primary-color, #1a73e8);\n          color: white;\n          border-radius: 12px;\n          font-size: 13px;\n        }\n        .apply-tags-btn {\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          padding: 8px 16px;\n          border: none;\n          border-radius: 6px;\n          background: #4caf50;\n          color: white;\n          cursor: pointer;\n        }\n        .apply-tags-btn:hover {\n          background: #43a047;\n        }\n        .ocr-info {\n          display: flex;\n          gap: 16px;\n          margin-bottom: 12px;\n          font-size: 13px;\n          color: var(--text-secondary, #666);\n        }\n        .extracted-text, .summary-text {\n          background: var(--bg-primary, white);\n          padding: 12px;\n          border-radius: 8px;\n          white-space: pre-wrap;\n          font-family: inherit;\n          font-size: 14px;\n          max-height: 200px;\n          overflow-y: auto;\n          margin: 0;\n        }\n        .method {\n          display: block;\n          margin-top: 8px;\n          color: var(--text-secondary, #666);\n        }\n      "})]})};export{p as default};
