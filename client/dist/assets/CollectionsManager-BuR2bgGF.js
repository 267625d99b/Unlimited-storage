import{a as n,j as e,l as o,m as l,b as a,c as s,n as i,o as t,k as c,f as r}from"./index-DmK7u7M1.js";import{r as d}from"./vendor-X31hiD63.js";import"./icons-jm45AAY8.js";const p="/api",x=["#1a73e8","#ea4335","#34a853","#fbbc04","#9c27b0","#00bcd4","#ff5722","#607d8b","#e91e63","#3f51b5"];function m(n){if(!n)return"0 B";const e=Math.floor(Math.log(n)/Math.log(1024));return parseFloat((n/Math.pow(1024,e)).toFixed(2))+" "+["B","KB","MB","GB"][e]}function u({onClose:u,onSelectCollection:b}){const[h,g]=d.useState([]),[f,j]=d.useState(!0),[v,y]=d.useState(!1),[N,k]=d.useState(null),[C,w]=d.useState(null),[S,$]=d.useState([]),[z,F]=d.useState(!1),[B,M]=d.useState(""),[E,G]=d.useState(""),[K,P]=d.useState(x[0]);d.useEffect(()=>{q()},[]);const q=async()=>{try{j(!0);const e=await n.get(`${p}/collections`);g(e.data.collections||[])}catch(e){}finally{j(!1)}},A=()=>{k(null),M(""),G(""),P(x[0])};return e.jsxs("div",{className:"modal-overlay",onClick:u,children:[e.jsxs("div",{className:"modal collections-modal",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:C?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"back-btn",onClick:()=>{w(null),$([])},children:e.jsx(o,{})}),e.jsx("span",{style:{color:C.color},children:e.jsx(l,{})}),C.name]}):e.jsxs(e.Fragment,{children:[e.jsx(l,{})," المجموعات"]})}),e.jsx("button",{className:"close-btn",onClick:u,children:e.jsx(a,{})})]}),e.jsx("div",{className:"modal-body",children:C?e.jsxs("div",{className:"collection-files",children:[C.description&&e.jsx("p",{className:"collection-description",children:C.description}),z?e.jsx("div",{className:"loading-state",children:e.jsx("div",{className:"spinner"})}):0===S.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(s,{size:48}),e.jsx("p",{children:"لا توجد ملفات في هذه المجموعة"})]}):e.jsx("div",{className:"files-list",children:S.map(o=>e.jsxs("div",{className:"file-item",children:[e.jsx(s,{}),e.jsxs("div",{className:"file-info",children:[e.jsx("span",{className:"file-name",children:o.name}),e.jsx("span",{className:"file-size",children:m(o.size)})]}),e.jsx("button",{className:"remove-btn",onClick:()=>(async e=>{var o,l;if(C)try{await n.delete(`${p}/collections/${C.id}/files/${e}`),$(S.filter(n=>n.id!==e))}catch(a){alert((null==(l=null==(o=a.response)?void 0:o.data)?void 0:l.error)||"فشل في إزالة الملف")}})(o.id),title:"إزالة من المجموعة",children:e.jsx(a,{})})]},o.id))})]}):e.jsxs(e.Fragment,{children:[v&&e.jsxs("div",{className:"collection-form",children:[e.jsx("input",{type:"text",value:B,onChange:n=>M(n.target.value),placeholder:"اسم المجموعة",autoFocus:!0}),e.jsx("input",{type:"text",value:E,onChange:n=>G(n.target.value),placeholder:"الوصف (اختياري)"}),e.jsx("div",{className:"color-picker",children:x.map(n=>e.jsx("button",{className:"color-btn "+(K===n?"selected":""),style:{background:n},onClick:()=>P(n)},n))}),e.jsxs("div",{className:"form-actions",children:[e.jsxs("button",{onClick:async()=>{var e,o;if(B.trim())try{await n.post(`${p}/collections`,{name:B.trim(),description:E.trim(),color:K}),M(""),G(""),P(x[0]),y(!1),q()}catch(l){alert((null==(o=null==(e=l.response)?void 0:e.data)?void 0:o.error)||"فشل في إنشاء المجموعة")}},disabled:!B.trim(),children:[e.jsx(i,{})," إنشاء"]}),e.jsx("button",{onClick:()=>y(!1),className:"cancel",children:"إلغاء"})]})]}),f?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"جاري تحميل المجموعات..."})]}):0!==h.length||v?e.jsx("div",{className:"collections-list",children:h.map(o=>e.jsx("div",{className:"collection-item",children:N===o.id?e.jsxs("div",{className:"collection-form inline",children:[e.jsx("input",{type:"text",value:B,onChange:n=>M(n.target.value),autoFocus:!0}),e.jsx("div",{className:"color-picker small",children:x.map(n=>e.jsx("button",{className:"color-btn "+(K===n?"selected":""),style:{background:n},onClick:()=>P(n)},n))}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{onClick:()=>(async e=>{var o,l;if(B.trim())try{await n.patch(`${p}/collections/${e}`,{name:B.trim(),description:E.trim(),color:K}),k(null),M(""),G(""),q()}catch(a){alert((null==(l=null==(o=a.response)?void 0:o.data)?void 0:l.error)||"فشل في تحديث المجموعة")}})(o.id),children:e.jsx(i,{})}),e.jsx("button",{onClick:A,className:"cancel",children:e.jsx(a,{})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"collection-info",onClick:()=>(async e=>{try{F(!0);const o=await n.get(`${p}/collections/${e}`);$(o.data.files||[]),w(o.data.collection)}catch(o){}finally{F(!1)}})(o.id),children:[e.jsx("span",{className:"collection-icon",style:{color:o.color},children:e.jsx(l,{})}),e.jsxs("div",{className:"collection-details",children:[e.jsx("span",{className:"collection-name",children:o.name}),e.jsxs("span",{className:"collection-count",children:[o.itemCount," ملف"]})]})]}),e.jsxs("div",{className:"collection-actions",children:[e.jsx("button",{onClick:()=>(n=>{k(n.id),M(n.name),G(n.description||""),P(n.color||x[0])})(o),children:e.jsx(c,{})}),e.jsx("button",{onClick:()=>(async e=>{var o,l;if(confirm("هل أنت متأكد من حذف هذه المجموعة؟"))try{await n.delete(`${p}/collections/${e}`),q(),(null==C?void 0:C.id)===e&&(w(null),$([]))}catch(a){alert((null==(l=null==(o=a.response)?void 0:o.data)?void 0:l.error)||"فشل في حذف المجموعة")}})(o.id),className:"danger",children:e.jsx(r,{})})]})]})},o.id))}):e.jsxs("div",{className:"empty-state",children:[e.jsx(l,{size:48}),e.jsx("p",{children:"لا توجد مجموعات"}),e.jsxs("button",{onClick:()=>y(!0),children:[e.jsx(t,{})," إنشاء مجموعة"]})]})]})}),!C&&!v&&h.length>0&&e.jsx("div",{className:"modal-footer",children:e.jsxs("button",{className:"btn primary",onClick:()=>y(!0),children:[e.jsx(t,{})," مجموعة جديدة"]})})]}),e.jsx("style",{children:"\n        .collections-modal {\n          max-width: 500px;\n          width: 95%;\n        }\n\n        .back-btn {\n          background: none;\n          border: none;\n          cursor: pointer;\n          padding: 4px;\n          margin-left: 8px;\n          color: var(--text-primary);\n        }\n\n        .collection-form {\n          padding: 16px;\n          background: var(--bg-secondary);\n          border-radius: 8px;\n          margin-bottom: 16px;\n        }\n\n        .collection-form.inline {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px;\n          align-items: center;\n          padding: 8px;\n        }\n\n        .collection-form input {\n          width: 100%;\n          padding: 10px;\n          border: 1px solid var(--border-color);\n          border-radius: 6px;\n          margin-bottom: 8px;\n        }\n\n        .collection-form.inline input {\n          flex: 1;\n          margin-bottom: 0;\n        }\n\n        .color-picker {\n          display: flex;\n          gap: 8px;\n          margin-bottom: 12px;\n        }\n\n        .color-picker.small {\n          margin-bottom: 0;\n        }\n\n        .color-btn {\n          width: 24px;\n          height: 24px;\n          border-radius: 50%;\n          border: 2px solid transparent;\n          cursor: pointer;\n          transition: transform 0.2s;\n        }\n\n        .color-btn.selected {\n          border-color: var(--text-primary);\n          transform: scale(1.2);\n        }\n\n        .form-actions {\n          display: flex;\n          gap: 8px;\n        }\n\n        .form-actions button {\n          display: flex;\n          align-items: center;\n          gap: 4px;\n          padding: 8px 16px;\n          border: none;\n          border-radius: 6px;\n          cursor: pointer;\n        }\n\n        .form-actions button:first-child {\n          background: var(--primary-color);\n          color: white;\n        }\n\n        .form-actions button.cancel {\n          background: var(--bg-hover);\n        }\n\n        .collections-list {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n        }\n\n        .collection-item {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 12px;\n          background: var(--bg-secondary);\n          border-radius: 8px;\n          transition: background 0.2s;\n        }\n\n        .collection-item:hover {\n          background: var(--bg-hover);\n        }\n\n        .collection-info {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          flex: 1;\n          cursor: pointer;\n        }\n\n        .collection-icon {\n          font-size: 1.5em;\n        }\n\n        .collection-details {\n          display: flex;\n          flex-direction: column;\n        }\n\n        .collection-name {\n          font-weight: 500;\n        }\n\n        .collection-count {\n          font-size: 0.85em;\n          color: var(--text-secondary);\n        }\n\n        .collection-actions {\n          display: flex;\n          gap: 4px;\n        }\n\n        .collection-actions button {\n          padding: 8px;\n          background: transparent;\n          border: none;\n          cursor: pointer;\n          border-radius: 6px;\n          color: var(--text-secondary);\n        }\n\n        .collection-actions button:hover {\n          background: var(--bg-hover);\n          color: var(--primary-color);\n        }\n\n        .collection-actions button.danger:hover {\n          color: #dc3545;\n        }\n\n        .collection-description {\n          padding: 12px;\n          background: var(--bg-secondary);\n          border-radius: 8px;\n          margin-bottom: 16px;\n          color: var(--text-secondary);\n        }\n\n        .files-list {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n        }\n\n        .file-item {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 10px 12px;\n          background: var(--bg-secondary);\n          border-radius: 6px;\n        }\n\n        .file-info {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n        }\n\n        .file-name {\n          font-weight: 500;\n        }\n\n        .file-size {\n          font-size: 0.85em;\n          color: var(--text-secondary);\n        }\n\n        .remove-btn {\n          padding: 6px;\n          background: transparent;\n          border: none;\n          cursor: pointer;\n          color: var(--text-secondary);\n          border-radius: 4px;\n        }\n\n        .remove-btn:hover {\n          background: var(--bg-hover);\n          color: #dc3545;\n        }\n\n        .empty-state {\n          text-align: center;\n          padding: 40px 20px;\n          color: var(--text-secondary);\n        }\n\n        .empty-state svg {\n          opacity: 0.5;\n          margin-bottom: 16px;\n        }\n\n        .empty-state button {\n          margin-top: 16px;\n          display: inline-flex;\n          align-items: center;\n          gap: 6px;\n          padding: 10px 20px;\n          background: var(--primary-color);\n          color: white;\n          border: none;\n          border-radius: 6px;\n          cursor: pointer;\n        }\n      "})]})}export{u as default};
