import{a as n,j as e,F as s,b as a,c as i,d as r,e as o,f as t}from"./index-C-f8kXnX.js";import{r as l}from"./vendor-X31hiD63.js";import"./icons-jm45AAY8.js";const d="/api";function c(n){if(!n)return"0 B";const e=Math.floor(Math.log(n)/Math.log(1024));return parseFloat((n/Math.pow(1024,e)).toFixed(2))+" "+["B","KB","MB","GB"][e]}function m(n){if(!n)return"";return new Date(n).toLocaleDateString("ar-SA",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function x({file:x,onClose:p,onRestore:v}){const[h,u]=l.useState([]),[f,g]=l.useState(!0),[b,j]=l.useState(null);l.useEffect(()=>{y()},[x.id]);const y=async()=>{try{g(!0);const e=await n.get(`${d}/versions/${x.id}`);u(e.data.versions||[])}catch(e){}finally{g(!1)}};return e.jsxs("div",{className:"modal-overlay",onClick:p,children:[e.jsxs("div",{className:"modal version-history-modal",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:[e.jsx(s,{})," سجل الإصدارات"]}),e.jsx("button",{className:"close-btn",onClick:p,children:e.jsx(a,{})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"current-file-info",children:[e.jsx(i,{}),e.jsx("span",{children:x.name}),e.jsx("span",{className:"file-size",children:c(x.size)})]}),f?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"جاري تحميل الإصدارات..."})]}):0===h.length?e.jsxs("div",{className:"empty-state",children:[e.jsx(s,{size:48}),e.jsx("p",{children:"لا توجد إصدارات سابقة"}),e.jsx("small",{children:"سيتم حفظ الإصدارات تلقائياً عند تحديث الملف"})]}):e.jsx("div",{className:"versions-list",children:h.map((s,a)=>e.jsxs("div",{className:"version-item",children:[e.jsxs("div",{className:"version-info",children:[e.jsxs("div",{className:"version-number",children:["الإصدار ",s.version_number,0===a&&e.jsx("span",{className:"latest-badge",children:"الأحدث"})]}),e.jsxs("div",{className:"version-meta",children:[e.jsx("span",{children:m(s.created_at)}),e.jsx("span",{className:"separator",children:"•"}),e.jsx("span",{children:c(s.size)})]}),s.comment&&e.jsx("div",{className:"version-comment",children:s.comment})]}),e.jsxs("div",{className:"version-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>(async e=>{try{await n.get(`${d}/versions/download/${e.id}`);const s=document.createElement("a");s.href=`${d}/download-file/${x.id}?version=${e.id}`,s.download=`${e.name}_v${e.version_number}`,document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(s){alert("فشل في تحميل الإصدار")}})(s),title:"تحميل",children:e.jsx(r,{})}),e.jsx("button",{className:"btn-icon",onClick:()=>(async e=>{var s,a;if(confirm("هل أنت متأكد من استعادة هذا الإصدار؟ سيتم حفظ الإصدار الحالي تلقائياً."))try{j(e),await n.post(`${d}/versions/${x.id}/restore/${e}`),null==v||v(),p()}catch(i){alert((null==(a=null==(s=i.response)?void 0:s.data)?void 0:a.error)||"فشل في استعادة الإصدار")}finally{j(null)}})(s.id),disabled:b===s.id,title:"استعادة",children:b===s.id?e.jsx("div",{className:"spinner-small"}):e.jsx(o,{})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>(async e=>{var s,a;if(confirm("هل أنت متأكد من حذف هذا الإصدار؟"))try{await n.delete(`${d}/versions/${e}`),u(h.filter(n=>n.id!==e))}catch(i){alert((null==(a=null==(s=i.response)?void 0:s.data)?void 0:a.error)||"فشل في حذف الإصدار")}})(s.id),title:"حذف",children:e.jsx(t,{})})]})]},s.id))})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("small",{children:"يتم حفظ آخر 10 إصدارات تلقائياً"}),e.jsx("button",{className:"btn secondary",onClick:p,children:"إغلاق"})]})]}),e.jsx("style",{children:"\n        .version-history-modal {\n          max-width: 600px;\n          width: 95%;\n        }\n\n        .current-file-info {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 12px;\n          background: var(--bg-secondary);\n          border-radius: 8px;\n          margin-bottom: 16px;\n        }\n\n        .current-file-info .file-size {\n          margin-right: auto;\n          color: var(--text-secondary);\n          font-size: 0.9em;\n        }\n\n        .versions-list {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n          max-height: 400px;\n          overflow-y: auto;\n        }\n\n        .version-item {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 12px;\n          background: var(--bg-secondary);\n          border-radius: 8px;\n          transition: background 0.2s;\n        }\n\n        .version-item:hover {\n          background: var(--bg-hover);\n        }\n\n        .version-info {\n          flex: 1;\n        }\n\n        .version-number {\n          font-weight: 600;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n\n        .latest-badge {\n          font-size: 0.75em;\n          padding: 2px 8px;\n          background: var(--primary-color);\n          color: white;\n          border-radius: 12px;\n          font-weight: normal;\n        }\n\n        .version-meta {\n          font-size: 0.85em;\n          color: var(--text-secondary);\n          margin-top: 4px;\n        }\n\n        .version-meta .separator {\n          margin: 0 6px;\n        }\n\n        .version-comment {\n          font-size: 0.85em;\n          color: var(--text-secondary);\n          margin-top: 4px;\n          font-style: italic;\n        }\n\n        .version-actions {\n          display: flex;\n          gap: 4px;\n        }\n\n        .btn-icon {\n          padding: 8px;\n          border: none;\n          background: transparent;\n          cursor: pointer;\n          border-radius: 6px;\n          color: var(--text-primary);\n          transition: all 0.2s;\n        }\n\n        .btn-icon:hover {\n          background: var(--bg-hover);\n          color: var(--primary-color);\n        }\n\n        .btn-icon.danger:hover {\n          color: #dc3545;\n        }\n\n        .btn-icon:disabled {\n          opacity: 0.5;\n          cursor: not-allowed;\n        }\n\n        .spinner-small {\n          width: 16px;\n          height: 16px;\n          border: 2px solid var(--border-color);\n          border-top-color: var(--primary-color);\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n        }\n\n        .empty-state {\n          text-align: center;\n          padding: 40px 20px;\n          color: var(--text-secondary);\n        }\n\n        .empty-state svg {\n          opacity: 0.5;\n          margin-bottom: 16px;\n        }\n\n        .modal-footer {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .modal-footer small {\n          color: var(--text-secondary);\n        }\n      "})]})}export{x as default};
