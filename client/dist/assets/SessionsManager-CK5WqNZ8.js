import{a as s,j as e,D as i,u as n,U as a,F as l,f as c,V as d,W as r,X as t,Y as o,Z as j}from"./index-BIUdtEPv.js";import{r as x}from"./vendor-X31hiD63.js";import"./icons-jm45AAY8.js";const h="/api",m=x.memo(function({onClose:m,showToast:u,embedded:v=!1}){const[N,b]=x.useState([]),[p,f]=x.useState(!0),[g,C]=x.useState(null),y=x.useCallback(async()=>{f(!0);try{const e=await s.get(`${h}/security/sessions`);b(e.data.sessions||[])}catch(e){null==u||u("فشل في تحميل الجلسات","error")}finally{f(!1)}},[u]);x.useEffect(()=>{y()},[y]);const k=async e=>{C(e);try{await s.delete(`${h}/security/sessions/${e}`),b(s=>s.filter(s=>s.id!==e)),null==u||u("تم إنهاء الجلسة بنجاح","success")}catch(i){null==u||u("فشل في إنهاء الجلسة","error")}finally{C(null)}},w=async(e=!0)=>{C("all");try{const i=await s.post(`${h}/security/sessions/logout-all`,{keepCurrent:e});null==u||u(i.data.message,"success"),y()}catch(i){null==u||u("فشل في تسجيل الخروج","error")}finally{C(null)}},I=s=>{var i;const n=(null==(i=null==s?void 0:s.device)?void 0:i.toLowerCase())||"";return n.includes("mobile")?e.jsx(o,{}):n.includes("tablet")?e.jsx(j,{}):e.jsx(a,{})},$=s=>{if(!s)return"غير معروف";const e=new Date(s),i=new Date-e;return i<6e4?"الآن":i<36e5?`منذ ${Math.floor(i/6e4)} دقيقة`:i<864e5?`منذ ${Math.floor(i/36e5)} ساعة`:e.toLocaleDateString("ar-SA")};return v?e.jsxs("div",{className:"sessions-embedded",children:[e.jsxs("div",{className:"sessions-header-embedded",children:[e.jsxs("h3",{children:[e.jsx(i,{})," الأجهزة المتصلة"]}),e.jsx("button",{className:"refresh-btn",onClick:y,disabled:p,children:e.jsx(n,{className:p?"spin":""})})]}),p?e.jsxs("div",{className:"sessions-loading",children:[e.jsx(n,{className:"spin"})," جاري التحميل..."]}):0===N.length?e.jsxs("div",{className:"no-sessions",children:[e.jsx(a,{}),e.jsx("p",{children:"لا توجد جلسات نشطة"})]}):e.jsx("div",{className:"sessions-list",children:N.map(s=>{var i;return e.jsxs("div",{className:"session-item "+(s.isCurrent?"current":""),children:[e.jsx("div",{className:"session-icon",children:I(s.deviceInfo)}),e.jsxs("div",{className:"session-info",children:[e.jsxs("div",{className:"session-device",children:[(null==(i=s.deviceInfo)?void 0:i.device)||"جهاز غير معروف",s.isCurrent&&e.jsx("span",{className:"current-badge",children:"الحالي"})]}),e.jsx("div",{className:"session-details",children:e.jsxs("span",{children:[e.jsx(l,{})," ",$(s.lastActivity)]})})]}),!s.isCurrent&&e.jsx("button",{className:"terminate-btn",onClick:()=>k(s.id),disabled:g===s.id,children:g===s.id?e.jsx(n,{className:"spin"}):e.jsx(c,{})})]},s.id)})}),N.length>1&&e.jsxs("button",{className:"logout-others-btn",onClick:()=>w(!0),disabled:"all"===g,children:[e.jsx(d,{})," تسجيل الخروج من الأجهزة الأخرى"]})]}):e.jsx("div",{className:"sessions-manager-overlay",onClick:m,children:e.jsxs("div",{className:"sessions-manager",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"sessions-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx(i,{}),e.jsx("h2",{children:"الأجهزة المتصلة"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"refresh-btn",onClick:y,disabled:p,children:e.jsx(n,{className:p?"spin":""})}),e.jsx("button",{className:"close-btn",onClick:m,children:"×"})]})]}),e.jsx("div",{className:"sessions-content",children:p?e.jsxs("div",{className:"sessions-loading",children:[e.jsx(n,{className:"spin"}),e.jsx("span",{children:"جاري التحميل..."})]}):0===N.length?e.jsxs("div",{className:"no-sessions",children:[e.jsx(a,{}),e.jsx("p",{children:"لا توجد جلسات نشطة"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sessions-list",children:N.map(s=>{var i,a;return e.jsxs("div",{className:"session-item "+(s.isCurrent?"current":""),children:[e.jsx("div",{className:"session-icon",children:I(s.deviceInfo)}),e.jsxs("div",{className:"session-info",children:[e.jsxs("div",{className:"session-device",children:[(null==(i=s.deviceInfo)?void 0:i.device)||"جهاز غير معروف",s.isCurrent&&e.jsx("span",{className:"current-badge",children:"الجهاز الحالي"})]}),e.jsxs("div",{className:"session-details",children:[e.jsxs("span",{children:[e.jsx(l,{}),$(s.lastActivity)]}),(null==(a=s.deviceInfo)?void 0:a.ip)&&e.jsxs("span",{children:[e.jsx(r,{}),s.deviceInfo.ip]})]})]}),!s.isCurrent&&e.jsx("button",{className:"terminate-btn",onClick:()=>k(s.id),disabled:g===s.id,children:g===s.id?e.jsx(n,{className:"spin"}):e.jsx(c,{})})]},s.id)})}),N.length>1&&e.jsxs("div",{className:"logout-all-section",children:[e.jsxs("div",{className:"warning-box",children:[e.jsx(t,{}),e.jsx("span",{children:"تسجيل الخروج من جميع الأجهزة سيؤدي إلى إنهاء جميع الجلسات الأخرى"})]}),e.jsxs("div",{className:"logout-buttons",children:[e.jsxs("button",{className:"logout-others-btn",onClick:()=>w(!0),disabled:"all"===g,children:[e.jsx(d,{}),"تسجيل الخروج من الأجهزة الأخرى"]}),e.jsxs("button",{className:"logout-all-btn",onClick:()=>w(!1),disabled:"all"===g,children:[e.jsx(d,{}),"تسجيل الخروج من جميع الأجهزة"]})]})]})]})})]})})});export{m as default};
